<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="mb-0 text-primary">Revisión por Sistemas</h2>
      <p class="text-muted mb-0">Registre la revisión por sistemas del paciente</p>
    </div>
  </div>

  <!-- Mensaje de carga -->
  <div *ngIf="cargandoRevisionSistemas" class="text-center py-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2 mb-0">Cargando registro de revisión por sistemas...</p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="errorRevisionSistemas && !cargandoRevisionSistemas" class="alert alert-danger" role="alert">
    {{ errorRevisionSistemas }}
  </div>

  <!-- Formulario de revisión de sistemas -->
  <div *ngIf="!cargandoRevisionSistemas && !errorRevisionSistemas && revisionSistemas" class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Revisión por Sistemas</h5>
    </div>
    <div class="card-body">
      <form #revisionForm="ngForm">
        <div class="row g-3">
          <!-- Sección de datos básicos -->
          <div class="col-12">
            <h6 class="fw-bold text-primary mb-3">Datos Generales</h6>
          </div>
          
          <div class="col-md-6">
            <label for="revorgsis_fecha" class="form-label small">Fecha</label>
            <input
              type="datetime-local"
              id="revorgsis_fecha"
              name="revorgsis_fecha"
              class="form-control form-control-sm"
              [(ngModel)]="revisionSistemas.revorgsis_fecha"
            >
          </div>
          
          <div class="col-md-6">
            <label for="pac_historiaclinica" class="form-label small">Paciente</label>
            <input
              type="text"
              id="pac_historiaclinica"
              name="pac_historiaclinica"
              class="form-control form-control-sm"
              [(ngModel)]="revisionSistemas.pac_historiaclinica"
              readonly
            >
          </div>
          
          <!-- Sección de descripción -->
          <div class="col-12 mt-3">
            <h6 class="fw-bold text-primary mb-3">Descripción del Examen</h6>
          </div>
          
          <div class="col-12">
            <label for="revorgsis_desc" class="form-label small">Descripción</label>
            <textarea
              id="revorgsis_desc"
              name="revorgsis_desc"
              class="form-control form-control-sm"
              [(ngModel)]="revisionSistemas.revorgsis_desc"
              rows="3"
            ></textarea>
          </div>
          
          <!-- Sección de detalle por órgano/sistema -->
          <div class="col-12 mt-3">
            <h6 class="fw-bold text-primary mb-3">Detalle por Órgano / Sistema</h6>
          </div>
          
          <div class="col-12">
            <div class="table-responsive">
              <table class="table table-sm table-bordered">
                <thead class="table-light">
                  <tr>
                    <th class="text-center">Órgano/Sistema</th>
                    <th class="text-center">Evidencia</th>
                    <th class="text-center">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let detalle of revisionSistemas.revorgsis_detalle; let i = index">
                    <td>
                      <select
                        class="form-select form-select-sm"
                        [(ngModel)]="detalle.orgsis_codigo"
                        [name]="'orgsis_codigo_' + i"
                      >
                        <option value="">Seleccione</option>
                        <option *ngFor="let organo of organosSistemas" [value]="organo.orgsis_codigo">
                          {{ organo.orgsis_desc }}
                        </option>
                      </select>
                    </td>
                    <td>
                      <select
                        class="form-select form-select-sm"
                        [(ngModel)]="detalle.detrev_evidencia"
                        [name]="'detrev_evidencia_' + i"
                      >
                        <option value="">Seleccione</option>
                        <option value="SI">SI</option>
                        <option value="NO">NO</option>
                      </select>
                    </td>
                    <td class="text-center">
                      <button type="button" class="btn btn-sm btn-danger" (click)="eliminarDetalle(i)">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="3" class="text-center">
                      <button type="button" class="btn btn-sm btn-outline-primary" (click)="agregarDetalle()">
                        <i class="fas fa-plus me-1"></i>Agregar Registro
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </form>
    </div>
    <div class="card-footer bg-light d-flex justify-content-end gap-2">
      <button type="button" class="btn btn-outline-secondary btn-sm" (click)="cancelar()">
        Cancelar
      </button>
      <button type="button" class="btn btn-primary btn-sm" (click)="guardar()" [disabled]="!revisionForm.valid">
        {{ modoEdicion ? 'Actualizar' : 'Guardar' }}
      </button>
    </div>
  </div>
</div>